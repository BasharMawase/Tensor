<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard | Tensor Academy</title>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        :root {
            --bg-dark: #0a0a0f;
            --bg-card: #13131f;
            --gold: #d4af37;
            --text: #f0f0f0;
            --text-muted: #888;
            --border: rgba(212, 175, 55, 0.2);
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --info: #3b82f6;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg-dark);
            color: var(--text);
            min-height: 100vh;
        }

        /* Admin Header */
        .admin-header {
            background: linear-gradient(135deg, rgba(11, 15, 22, 0.95), rgba(5, 8, 15, 0.95));
            backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--border);
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .admin-logo {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .logo-icon {
            font-size: 2rem;
            color: var(--gold);
        }

        .logo-text {
            font-size: 1.5rem;
            font-weight: 700;
            background: linear-gradient(45deg, var(--gold), #f1d58a);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .admin-actions {
            display: flex;
            gap: 1rem;
        }

        .btn {
            padding: 0.5rem 1rem;
            border-radius: 5px;
            border: 1px solid var(--border);
            background: transparent;
            color: var(--text);
            cursor: pointer;
            font-family: inherit;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: var(--gold);
            color: #000;
            border-color: var(--gold);
        }

        .btn-primary:hover {
            background: #f1d58a;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(212, 175, 55, 0.3);
        }

        /* Admin Container */
        .admin-container {
            display: flex;
            min-height: calc(100vh - 70px);
        }

        /* Sidebar */
        .admin-sidebar {
            width: 250px;
            background: rgba(19, 19, 31, 0.8);
            border-right: 1px solid var(--border);
            padding: 2rem 1rem;
        }

        .nav-section {
            margin-bottom: 2rem;
        }

        .section-title {
            color: var(--text-muted);
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 1rem;
            padding-left: 1rem;
        }

        .nav-link {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 0.8rem 1rem;
            color: var(--text);
            text-decoration: none;
            border-radius: 5px;
            margin-bottom: 0.5rem;
            transition: all 0.3s ease;
        }

        .nav-link:hover {
            background: rgba(212, 175, 55, 0.1);
            color: var(--gold);
        }

        .nav-link.active {
            background: rgba(212, 175, 55, 0.15);
            color: var(--gold);
            border-left: 3px solid var(--gold);
        }

        .nav-icon {
            font-size: 1.2rem;
        }

        /* Main Content */
        .admin-main {
            flex: 1;
            padding: 2rem;
            overflow-y: auto;
        }

        /* Dashboard Grid */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin-bottom: 2rem;
        }

        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 1.5rem;
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            border-color: var(--gold);
            box-shadow: 0 10px 30px rgba(212, 175, 55, 0.1);
        }

        .stat-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .stat-icon {
            font-size: 1.5rem;
            color: var(--gold);
            background: rgba(212, 175, 55, 0.1);
            width: 50px;
            height: 50px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .stat-title {
            color: var(--text-muted);
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .stat-change {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.9rem;
        }

        .stat-change.positive {
            color: var(--success);
        }

        .stat-change.negative {
            color: var(--danger);
        }

        /* Charts */
        .chart-container {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }

        .chart-title {
            font-size: 1.2rem;
            margin-bottom: 1rem;
            color: var(--text);
        }

        .chart-wrapper {
            height: 300px;
            position: relative;
        }

        /* Tables */
        .data-table {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 2rem;
        }

        .table-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .table-title {
            font-size: 1.2rem;
            color: var(--text);
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th {
            background: rgba(212, 175, 55, 0.05);
            color: var(--text-muted);
            font-weight: 600;
            text-align: left;
            padding: 1rem;
            border-bottom: 1px solid var(--border);
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        td {
            padding: 1rem;
            border-bottom: 1px solid var(--border);
            color: var(--text);
        }

        tr:hover {
            background: rgba(212, 175, 55, 0.02);
        }

        .status-badge {
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .status-new {
            background: rgba(59, 130, 246, 0.1);
            color: var(--info);
        }

        .status-pending {
            background: rgba(245, 158, 11, 0.1);
            color: var(--warning);
        }

        .status-completed {
            background: rgba(16, 185, 129, 0.1);
            color: var(--success);
        }

        .action-btn {
            background: transparent;
            border: 1px solid var(--border);
            color: var(--text);
            width: 30px;
            height: 30px;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .action-btn:hover {
            border-color: var(--gold);
            color: var(--gold);
        }

        /* Forms */
        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            color: var(--text);
            font-weight: 500;
        }

        .form-input {
            width: 100%;
            padding: 0.8rem;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border);
            border-radius: 5px;
            color: var(--text);
            font-family: inherit;
            transition: all 0.3s ease;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--gold);
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 2rem;
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .modal-title {
            font-size: 1.5rem;
            color: var(--text);
        }

        .modal-close {
            background: transparent;
            border: none;
            color: var(--text-muted);
            font-size: 1.5rem;
            cursor: pointer;
            transition: color 0.3s ease;
        }

        .modal-close:hover {
            color: var(--danger);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .admin-container {
                flex-direction: column;
            }

            .admin-sidebar {
                width: 100%;
                padding: 1rem;
            }

            .dashboard-grid {
                grid-template-columns: 1fr;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>

<body>
    <!-- Header -->
    <header class="admin-header">
        <div class="admin-logo">
            <div class="logo-icon">‚àá</div>
            <div class="logo-text">Tensor Admin</div>
        </div>
        <div class="admin-actions">
            <button class="btn" onclick="exportData()">Export Data</button>
            <button class="btn btn-primary" onclick="refreshData()">Refresh</button>
        </div>
    </header>

    <!-- Main Container -->
    <div class="admin-container">
        <!-- Sidebar -->
        <nav class="admin-sidebar">
            <div class="nav-section">
                <div class="section-title">Dashboard</div>
                <a href="#" class="nav-link active" onclick="showSection('dashboard')">
                    <span class="nav-icon">üìä</span>
                    <span>Overview</span>
                </a>
                <a href="#" class="nav-link" onclick="showSection('analytics')">
                    <span class="nav-icon">üìà</span>
                    <span>Analytics</span>
                </a>
            </div>

            <div class="nav-section">
                <div class="section-title">Users</div>
                <a href="#" class="nav-link" onclick="showSection('users')">
                    <span class="nav-icon">üë•</span>
                    <span>All Users</span>
                </a>
                <a href="#" class="nav-link" onclick="showSection('signups')">
                    <span class="nav-icon">üìù</span>
                    <span>Signups</span>
                </a>
            </div>

            <div class="nav-section">
                <div class="section-title">Academics</div>
                <a href="#" class="nav-link" onclick="showSection('courses')">
                    <span class="nav-icon">üìö</span>
                    <span>Course Views</span>
                </a>
                <a href="#" class="nav-link" onclick="showSection('languages')">
                    <span class="nav-icon">üåê</span>
                    <span>Language Interest</span>
                </a>
            </div>

            <div class="nav-section">
                <div class="section-title">Finance</div>
                <a href="#" class="nav-link" onclick="showSection('payments')">
                    <span class="nav-icon">üí∞</span>
                    <span>Donations</span>
                </a>
                <a href="#" class="nav-link" onclick="showSection('lessons')">
                    <span class="nav-icon">üéØ</span>
                    <span>Private Lessons</span>
                </a>
            </div>

            <div class="nav-section">
                <div class="section-title">Settings</div>
                <a href="#" class="nav-link" onclick="showSection('data')">
                    <span class="nav-icon">üóÉÔ∏è</span>
                    <span>Data Collection</span>
                </a>
                <a href="#" class="nav-link" onclick="clearAllData()">
                    <span class="nav-icon">üóëÔ∏è</span>
                    <span>Clear Data</span>
                </a>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="admin-main">
            <!-- Dashboard Section -->
            <section id="dashboard-section" class="section active">
                <h1 style="margin-bottom: 2rem; color: var(--gold);">Dashboard Overview</h1>

                <!-- Stats Grid -->
                <div class="stats-grid" id="stats-grid">
                    <!-- Stats will be populated by JavaScript -->
                </div>

                <!-- Charts -->
                <div class="dashboard-grid">
                    <div class="chart-container">
                        <h3 class="chart-title">Daily Visitors</h3>
                        <div class="chart-wrapper">
                            <canvas id="visitorsChart"></canvas>
                        </div>
                    </div>

                    <div class="chart-container">
                        <h3 class="chart-title">Course Popularity</h3>
                        <div class="chart-wrapper">
                            <canvas id="coursesChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Recent Activity -->
                <div class="data-table">
                    <div class="table-header">
                        <h3 class="table-title">Recent Activity</h3>
                    </div>
                    <div style="padding: 1.5rem;" id="recent-activity">
                        <!-- Activity will be populated by JavaScript -->
                    </div>
                </div>
            </section>

            <!-- Analytics Section -->
            <section id="analytics-section" class="section">
                <h1 style="margin-bottom: 2rem; color: var(--gold);">Website Analytics</h1>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-title">Total Page Views</div>
                            <div class="stat-icon">üëÅÔ∏è</div>
                        </div>
                        <div class="stat-value" id="total-pageviews">0</div>
                        <div class="stat-change" id="pageviews-change">Loading...</div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-title">Avg. Session Time</div>
                            <div class="stat-icon">‚è±Ô∏è</div>
                        </div>
                        <div class="stat-value" id="avg-session-time">0s</div>
                        <div class="stat-change" id="session-change">Loading...</div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-title">Bounce Rate</div>
                            <div class="stat-icon">‚Ü™Ô∏è</div>
                        </div>
                        <div class="stat-value" id="bounce-rate">0%</div>
                        <div class="stat-change" id="bounce-change">Loading...</div>
                    </div>
                </div>

                <div class="chart-container">
                    <h3 class="chart-title">Traffic Sources</h3>
                    <div class="chart-wrapper">
                        <canvas id="trafficChart"></canvas>
                    </div>
                </div>

                <div class="data-table">
                    <div class="table-header">
                        <h3 class="table-title">Most Visited Pages</h3>
                    </div>
                    <table id="top-pages-table">
                        <thead>
                            <tr>
                                <th>Page Path</th>
                                <th>Views</th>
                                <th>Unique Visitors</th>
                                <th>Bounce Rate</th>
                            </tr>
                        </thead>
                        <tbody id="top-pages-table-body">
                            <!-- Populated by JS -->
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Users Section -->
            <section id="users-section" class="section">
                <h1 style="margin-bottom: 2rem; color: var(--gold);">User Management</h1>

                <div class="data-table">
                    <div class="table-header">
                        <h3 class="table-title">All Users</h3>
                        <button class="btn btn-primary" onclick="addUser()">Add User</button>
                    </div>
                    <table id="users-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Name</th>
                                <th>Email</th>
                                <th>Type</th>
                                <th>Signup Date</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="users-table-body">
                            <!-- Users will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Signups Section -->
            <section id="signups-section" class="section">
                <h1 style="margin-bottom: 2rem; color: var(--gold);">User Signups</h1>

                <div class="chart-container">
                    <h3 class="chart-title">Signups Over Time</h3>
                    <div class="chart-wrapper">
                        <canvas id="signupsChart"></canvas>
                    </div>
                </div>

                <div class="data-table">
                    <div class="table-header">
                        <h3 class="table-title">Recent Signups</h3>
                    </div>
                    <table id="signups-table">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Name</th>
                                <th>Email</th>
                                <th>Interests</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody id="signups-table-body">
                            <!-- Signups will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Courses Section -->
            <section id="courses-section" class="section">
                <h1 style="margin-bottom: 2rem; color: var(--gold);">Course Analytics</h1>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-title">Most Viewed Course</div>
                            <div class="stat-icon">üèÜ</div>
                        </div>
                        <div class="stat-value" id="top-course">None</div>
                        <div class="stat-change" id="course-views">0 views</div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-title">Total Course Views</div>
                            <div class="stat-icon">üìä</div>
                        </div>
                        <div class="stat-value" id="total-course-views">0</div>
                        <div class="stat-change" id="course-views-change">Loading...</div>
                    </div>
                </div>

                <div class="data-table">
                    <div class="table-header">
                        <h3 class="table-title">Course Performance</h3>
                    </div>
                    <table id="courses-table">
                        <thead>
                            <tr>
                                <th>Course</th>
                                <th>Views</th>
                                <th>Clicks</th>
                                <th>Conversion</th>
                                <th>Popularity</th>
                            </tr>
                        </thead>
                        <tbody id="courses-table-body">
                            <!-- Courses will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Languages Section -->
            <section id="languages-section" class="section">
                <h1 style="margin-bottom: 2rem; color: var(--gold);">Language Interest</h1>

                <div class="chart-container">
                    <h3 class="chart-title">Language Popularity</h3>
                    <div class="chart-wrapper">
                        <canvas id="languagesChart"></canvas>
                    </div>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-title">Most Popular Language</div>
                            <div class="stat-icon">üåç</div>
                        </div>
                        <div class="stat-value" id="top-language">None</div>
                        <div class="stat-change" id="language-clicks">0 clicks</div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-title">Total Language Clicks</div>
                            <div class="stat-icon">üìà</div>
                        </div>
                        <div class="stat-value" id="total-language-clicks">0</div>
                        <div class="stat-change" id="language-change">Loading...</div>
                    </div>
                </div>
            </section>

            <!-- Payments Section -->
            <section id="payments-section" class="section">
                <h1 style="margin-bottom: 2rem; color: var(--gold);">Payment Analytics</h1>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-title">Total Revenue</div>
                            <div class="stat-icon">üí∞</div>
                        </div>
                        <div class="stat-value" id="total-revenue">$0</div>
                        <div class="stat-change" id="revenue-change">Loading...</div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-title">Avg. Donation</div>
                            <div class="stat-icon">üìä</div>
                        </div>
                        <div class="stat-value" id="avg-donation">$0</div>
                        <div class="stat-change" id="donation-change">Loading...</div>
                    </div>
                </div>

                <div class="data-table">
                    <div class="table-header">
                        <h3 class="table-title">Recent Donations</h3>
                    </div>
                    <table id="payments-table">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Amount</th>
                                <th>Donor</th>
                                <th>Method</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody id="payments-table-body">
                            <!-- Payments will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Lessons Section -->
            <section id="lessons-section" class="section">
                <h1 style="margin-bottom: 2rem; color: var(--gold);">Private Lessons</h1>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-title">Total Lessons</div>
                            <div class="stat-icon">üéØ</div>
                        </div>
                        <div class="stat-value" id="total-lessons">0</div>
                        <div class="stat-change" id="lessons-change">Loading...</div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-title">Revenue</div>
                            <div class="stat-icon">üíµ</div>
                        </div>
                        <div class="stat-value" id="lessons-revenue">$0</div>
                        <div class="stat-change" id="lessons-revenue-change">Loading...</div>
                    </div>
                </div>

                <div class="data-table">
                    <div class="table-header">
                        <h3 class="table-title">Lesson Requests</h3>
                    </div>
                    <table id="lessons-table">
                        <thead>
                            <tr>
                                <th>Date Requested</th>
                                <th>Student</th>
                                <th>Phone</th>
                                <th>Subject</th>
                                <th>Duration</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="lessons-table-body">
                            <!-- Lessons will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Data Collection Section -->
            <section id="data-section" class="section">
                <h1 style="margin-bottom: 2rem; color: var(--gold);">Data Collection Settings</h1>

                <div class="chart-container">
                    <h3 class="chart-title">Data Collection Status</h3>
                    <div style="padding: 1rem;">
                        <div class="form-group">
                            <label class="form-label">Data Collection Enabled</label>
                            <div style="display: flex; gap: 1rem; align-items: center;">
                                <input type="checkbox" id="data-collection" checked onchange="toggleDataCollection()">
                                <span id="data-status">Active - Collecting data from main site</span>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Storage Usage</label>
                            <div style="background: rgba(255, 255, 255, 0.05); padding: 1rem; border-radius: 5px;">
                                <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                    <span>LocalStorage Usage:</span>
                                    <span id="storage-usage">Calculating...</span>
                                </div>
                                <div
                                    style="width: 100%; height: 10px; background: rgba(255, 255, 255, 0.1); border-radius: 5px; overflow: hidden;">
                                    <div id="storage-bar" style="height: 100%; background: var(--gold); width: 0%;">
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Export Settings</label>
                            <div style="display: flex; gap: 1rem; margin-top: 1rem;">
                                <button class="btn" onclick="exportData()">Export as JSON</button>
                                <button class="btn" onclick="exportCSV()">Export as CSV</button>
                                <button class="btn btn-primary" onclick="backupData()">Create Backup</button>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Data Collection Script</label>
                            <div
                                style="background: rgba(0, 0, 0, 0.3); padding: 1rem; border-radius: 5px; margin-top: 1rem;">
                                <p style="color: var(--text-muted); margin-bottom: 1rem;">
                                    Add this script to your main website to start collecting data:
                                </p>
                                <pre
                                    style="background: rgba(0, 0, 0, 0.5); padding: 1rem; border-radius: 5px; overflow-x: auto;">
<span style="color: var(--gold);">&lt;script&gt;</span>
// Data Collection for Tensor Academy
(function() {
    const trackEvent = (type, data) => {
        const events = JSON.parse(localStorage.getItem('tensor_events') || '[]');
        events.push({
            type,
            data,
            timestamp: new Date().toISOString(),
            page: window.location.href,
            userAgent: navigator.userAgent
        });
        localStorage.setItem('tensor_events', JSON.stringify(events));
    };

    // Track page views
    trackEvent('pageview', { path: window.location.pathname });

    // Track button clicks
    document.addEventListener('click', (e) => {
        if (e.target.matches('a, button, .btn, .course-card, .lang-card')) {
            trackEvent('click', {
                element: e.target.tagName,
                text: e.target.textContent.trim().substring(0, 100),
                id: e.target.id || e.target.className
            });
        }
    });

    // Track form submissions
    document.addEventListener('submit', (e) => {
        trackEvent('form_submit', {
            formId: e.target.id,
            action: e.target.action
        });
    });

    console.log('Tensor Academy data collection active');
})();
<span style="color: var(--gold);">&lt;/script&gt;</span></pre>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Modals -->
    <div id="add-user-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Add New User</h3>
                <button class="modal-close" onclick="closeModal('add-user-modal')">√ó</button>
            </div>
            <form onsubmit="saveUser(event)">
                <div class="form-group">
                    <label class="form-label">Full Name</label>
                    <input type="text" class="form-input" id="user-name" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Email</label>
                    <input type="email" class="form-input" id="user-email" required>
                </div>
                <div class="form-group">
                    <label class="form-label">User Type</label>
                    <select class="form-input" id="user-type" required>
                        <option value="student">Student</option>
                        <option value="teacher">Teacher</option>
                        <option value="admin">Admin</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Notes</label>
                    <textarea class="form-input" id="user-notes" rows="3"></textarea>
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%;">Save User</button>
            </form>
        </div>
    </div>

    <script>
        // Data Collection and Management System

        // Initialize data storage
        class DataManager {
            constructor() {
                this.initializeData();
                this.loadData();
                this.startAutoRefresh();
            }

            initializeData() {
                // Create default data structures if they don't exist
                const defaults = {
                    users: [],
                    events: [],
                    pageviews: [],
                    clicks: [],
                    signups: [],
                    course_views: {},
                    language_clicks: {},
                    payments: [],
                    lessons: [],
                    analytics: {
                        daily_visitors: {},
                        traffic_sources: {}
                    }
                };

                Object.keys(defaults).forEach(key => {
                    if (!localStorage.getItem(`tensor_${key}`)) {
                        localStorage.setItem(`tensor_${key}`, JSON.stringify(defaults[key]));
                    }
                });
            }

            async loadData() {
                // Load all data from localStorage
                this.data = {};
                const keys = ['users', 'events', 'pageviews', 'clicks', 'signups', 'course_views', 'language_clicks', 'payments', 'lessons', 'analytics'];

                keys.forEach(key => {
                    try {
                        this.data[key] = JSON.parse(localStorage.getItem(`tensor_${key}`)) || (key === 'analytics' ? {} : []);
                    } catch (e) {
                        this.data[key] = key === 'analytics' ? {} : [];
                        console.warn(`Failed to parse ${key}:`, e);
                    }
                });

                // Fetch real lessons from server
                try {
                    const response = await fetch('/api/admin/lessons');
                    if (response.ok) {
                        const serverLessons = await response.json();
                        if (Array.isArray(serverLessons)) {
                            this.data.lessons = serverLessons;
                        }
                    }
                } catch (e) {
                    console.warn('Failed to fetch lessons from server, using local data:', e);
                }

                // If we have events from the main site, process them
                const events = JSON.parse(localStorage.getItem('tensor_events') || '[]');
                if (events.length > 0) {
                    this.processEvents(events);
                    // Clear processed events to avoid duplicates
                    localStorage.removeItem('tensor_events');
                }

                this.updateAllCharts();
                this.updateAllTables();
                this.updateStorageInfo();
            }

            processEvents(events) {
                events.forEach(event => {
                    switch (event.type) {
                        case 'pageview':
                            this.data.pageviews.push({
                                timestamp: event.timestamp,
                                page: event.data.path,
                                userAgent: event.userAgent
                            });
                            break;
                        case 'click':
                            this.data.clicks.push({
                                timestamp: event.timestamp,
                                element: event.data.element,
                                text: event.data.text,
                                page: event.page
                            });
                            break;
                        case 'form_submit':
                            // You can process form submissions here
                            break;
                    }
                });

                // Save updated data
                this.saveData();
            }

            saveData() {
                Object.keys(this.data).forEach(key => {
                    localStorage.setItem(`tensor_${key}`, JSON.stringify(this.data[key]));
                });
            }

            addUser(user) {
                user.id = Date.now();
                user.created = new Date().toISOString();
                this.data.users.push(user);
                this.saveData();
                this.updateUsersTable();
            }

            addSignup(signup) {
                signup.id = Date.now();
                signup.timestamp = new Date().toISOString();
                signup.status = 'new';
                this.data.signups.push(signup);
                this.saveData();
                this.updateSignupsTable();
            }

            addPayment(payment) {
                payment.id = Date.now();
                payment.timestamp = new Date().toISOString();
                payment.status = 'completed';
                this.data.payments.push(payment);
                this.saveData();
                this.updatePaymentsTable();
            }

            addLesson(lesson) {
                lesson.id = Date.now();
                lesson.timestamp = new Date().toISOString();
                lesson.status = 'requested';
                this.data.lessons.push(lesson);
                this.saveData();
                this.updateLessonsTable();
            }

            trackCourseView(course) {
                this.data.course_views[course] = (this.data.course_views[course] || 0) + 1;
                this.saveData();
            }

            trackLanguageClick(language) {
                this.data.language_clicks[language] = (this.data.language_clicks[language] || 0) + 1;
                this.saveData();
            }

            // Statistics Calculations
            getTotalPageViews() {
                return this.data.pageviews.length;
            }

            getTotalUsers() {
                return this.data.users.length;
            }

            getTotalSignups() {
                return this.data.signups.length;
            }

            getTotalRevenue() {
                return this.data.payments.reduce((sum, p) => sum + (parseFloat(p.amount) || 0), 0);
            }

            getTotalLessons() {
                return this.data.lessons.length;
            }

            getDailyVisitors() {
                const daily = {};
                this.data.pageviews.forEach(view => {
                    const date = view.timestamp.split('T')[0];
                    daily[date] = (daily[date] || 0) + 1;
                });
                return daily;
            }

            getCoursePopularity() {
                return Object.entries(this.data.course_views)
                    .sort((a, b) => b[1] - a[1])
                    .slice(0, 10);
            }

            getLanguagePopularity() {
                return Object.entries(this.data.language_clicks)
                    .sort((a, b) => b[1] - a[1]);
            }

            getRecentActivity() {
                const allActivity = [
                    ...this.data.signups.map(s => ({ ...s, type: 'signup' })),
                    ...this.data.payments.map(p => ({ ...p, type: 'payment' })),
                    ...this.data.lessons.map(l => ({ ...l, type: 'lesson' }))
                ].sort((a, b) => new Date(b.timestamp || b.created) - new Date(a.timestamp || a.created))
                    .slice(0, 10);

                return allActivity;
            }

            updateAllCharts() {
                this.updateVisitorsChart();
                this.updateCoursesChart();
                this.updateTrafficChart();
                this.updateSignupsChart();
                this.updateLanguagesChart();
            }

            updateAllTables() {
                this.updateStats();
                this.updateAnalyticsSection();
                this.updateRecentActivity();
                this.updateUsersTable();
                this.updateSignupsTable();
                this.updateCoursesTable();
                this.updatePaymentsTable();
                this.updateLessonsTable();
            }

            updateStats() {
                // Update stats grid
                const totalPageViews = this.getTotalPageViews();
                const stats = [
                    { id: 'total-users', title: 'Total Users', value: this.getTotalUsers(), icon: 'üë•' },
                    { id: 'total-views', title: 'Page Views', value: totalPageViews, icon: 'üëÅÔ∏è' },
                    { id: 'total-revenue', title: 'Total Revenue', value: `$${this.getTotalRevenue()}`, icon: 'üí∞' },
                    { id: 'total-lessons', title: 'Lessons', value: this.getTotalLessons(), icon: 'üéØ' },
                    { id: 'active-courses', title: 'Active Courses', value: Object.keys(this.data.course_views).length, icon: 'üìö' },
                    { id: 'signups-today', title: 'Today\'s Signups', value: this.getDailySignups(), icon: 'üìà' }
                ];

                const statsGrid = document.getElementById('stats-grid');
                if (statsGrid) {
                    statsGrid.innerHTML = stats.map(stat => `
                        <div class="stat-card">
                            <div class="stat-header">
                                <div class="stat-title">${stat.title}</div>
                                <div class="stat-icon">${stat.icon}</div>
                            </div>
                            <div class="stat-value">${stat.value}</div>
                            <div class="stat-change positive">
                                <span>Updated just now</span>
                            </div>
                        </div>
                    `).join('');
                }

                // Update Overview/Analytics cards specifically
                const totalPageViewsEl = document.getElementById('total-pageviews');
                if (totalPageViewsEl) totalPageViewsEl.textContent = totalPageViews;

                const overviewTotalLessons = document.getElementById('total-lessons');
                if (overviewTotalLessons && !statsGrid) overviewTotalLessons.textContent = this.getTotalLessons();
            }

            updateAnalyticsSection() {
                const totalPageViews = this.getTotalPageViews();
                const totalPageViewsEl = document.getElementById('total-pageviews');
                if (totalPageViewsEl) totalPageViewsEl.textContent = totalPageViews;

                // Simple simulated metrics for now but based on real view counts
                const bounceRate = totalPageViews > 0 ? (Math.max(5, 45 - Math.floor(totalPageViews / 10))) : 0;
                const bounceRateEl = document.getElementById('bounce-rate');
                if (bounceRateEl) bounceRateEl.textContent = bounceRate + '%';

                const avgTime = totalPageViews > 0 ? (2 + Math.min(5, totalPageViews / 20)).toFixed(1) : '0';
                const avgSessionEl = document.getElementById('avg-session-time');
                if (avgSessionEl) avgSessionEl.textContent = avgTime + 'm';

                this.updateTopPagesTable();
            }

            updateTopPagesTable() {
                const pageCounts = {};
                this.data.pageviews.forEach(pv => {
                    const path = pv.page || '/';
                    pageCounts[path] = (pageCounts[path] || 0) + 1;
                });

                const sortedPages = Object.entries(pageCounts)
                    .sort((a, b) => b[1] - a[1])
                    .slice(0, 10);

                const tbody = document.getElementById('top-pages-table-body');
                if (!tbody) return;

                if (sortedPages.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="4" style="text-align: center; color: var(--text-muted);">No page view data yet</td></tr>';
                    return;
                }

                tbody.innerHTML = sortedPages.map(([path, views]) => {
                    const unique = Math.ceil(views * 0.7); // Mock unique
                    const bounce = (Math.random() * 20 + 30).toFixed(1); // Mock bounce
                    return `
                        <tr>
                            <td><code>${path}</code></td>
                            <td>${views}</td>
                            <td>${unique}</td>
                            <td>${bounce}%</td>
                        </tr>
                    `;
                }).join('');
            }

            getDailySignups() {
                const today = new Date().toISOString().split('T')[0];
                return this.data.signups.filter(s =>
                    (s.timestamp || s.created).startsWith(today)
                ).length;
            }

            updateRecentActivity() {
                const activity = this.getRecentActivity();
                const container = document.getElementById('recent-activity');

                if (activity.length === 0) {
                    container.innerHTML = '<p style="text-align: center; color: var(--text-muted); padding: 2rem;">No recent activity yet.</p>';
                    return;
                }

                container.innerHTML = activity.map(item => `
                    <div style="display: flex; align-items: center; padding: 1rem; border-bottom: 1px solid var(--border);">
                        <div style="margin-right: 1rem; font-size: 1.5rem;">
                            ${item.type === 'signup' ? 'üìù' :
                        item.type === 'payment' ? 'üí∞' : 'üéØ'}
                        </div>
                        <div style="flex: 1;">
                            <div style="font-weight: 500; color: var(--text);">
                                ${item.type === 'signup' ? 'New Signup' :
                        item.type === 'payment' ? 'New Donation' : 'New Lesson Request'}
                            </div>
                            <div style="font-size: 0.9rem; color: var(--text-muted);">
                                ${item.name || item.donor || 'Anonymous'} - 
                                ${new Date(item.timestamp || item.created).toLocaleString()}
                            </div>
                        </div>
                        <span class="status-badge status-${item.status === 'new' ? 'new' : 'completed'}">
                            ${item.status}
                        </span>
                    </div>
                `).join('');
            }

            // Chart Updates
            updateVisitorsChart() {
                const daily = this.getDailyVisitors();
                const labels = Object.keys(daily).slice(-7);
                const data = labels.map(label => daily[label] || 0);

                if (window.visitorsChart) {
                    window.visitorsChart.destroy();
                }

                const ctx = document.getElementById('visitorsChart').getContext('2d');
                window.visitorsChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'Daily Visitors',
                            data: data,
                            borderColor: 'rgba(212, 175, 55, 1)',
                            backgroundColor: 'rgba(212, 175, 55, 0.1)',
                            borderWidth: 2,
                            tension: 0.4,
                            fill: true
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                labels: {
                                    color: 'rgba(240, 240, 240, 0.8)'
                                }
                            }
                        },
                        scales: {
                            x: {
                                grid: {
                                    color: 'rgba(255, 255, 255, 0.05)'
                                },
                                ticks: {
                                    color: 'rgba(240, 240, 240, 0.6)'
                                }
                            },
                            y: {
                                grid: {
                                    color: 'rgba(255, 255, 255, 0.05)'
                                },
                                ticks: {
                                    color: 'rgba(240, 240, 240, 0.6)'
                                }
                            }
                        }
                    }
                });
            }

            updateCoursesChart() {
                const courses = this.getCoursePopularity();
                const labels = courses.map(c => c[0]);
                const data = courses.map(c => c[1]);

                if (window.coursesChart) {
                    window.coursesChart.destroy();
                }

                const ctx = document.getElementById('coursesChart').getContext('2d');
                window.coursesChart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'Views',
                            data: data,
                            backgroundColor: 'rgba(212, 175, 55, 0.7)',
                            borderColor: 'rgba(212, 175, 55, 1)',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                labels: {
                                    color: 'rgba(240, 240, 240, 0.8)'
                                }
                            }
                        },
                        scales: {
                            x: {
                                grid: {
                                    color: 'rgba(255, 255, 255, 0.05)'
                                },
                                ticks: {
                                    color: 'rgba(240, 240, 240, 0.6)'
                                }
                            },
                            y: {
                                grid: {
                                    color: 'rgba(255, 255, 255, 0.05)'
                                },
                                ticks: {
                                    color: 'rgba(240, 240, 240, 0.6)'
                                }
                            }
                        }
                    }
                });
            }

            updateTrafficChart() {
                const total = this.getTotalPageViews();

                // Base distribution
                const sources = {
                    'Direct': 40 + (total % 10),
                    'Search': 35 + (total % 5),
                    'Social': 15 + (total % 3),
                    'Referral': 10
                };

                if (window.trafficChart) {
                    window.trafficChart.destroy();
                }

                const ctx = document.getElementById('trafficChart').getContext('2d');
                window.trafficChart = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: Object.keys(sources),
                        datasets: [{
                            data: Object.values(sources),
                            backgroundColor: [
                                'rgba(212, 175, 55, 0.7)',
                                'rgba(16, 185, 129, 0.7)',
                                'rgba(59, 130, 246, 0.7)',
                                'rgba(139, 92, 246, 0.7)'
                            ]
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: {
                                    color: 'rgba(240, 240, 240, 0.8)'
                                }
                            }
                        }
                    }
                });
            }

            updateSignupsChart() {
                // Create sample signup data for the last 7 days
                const dates = Array.from({ length: 7 }, (_, i) => {
                    const d = new Date();
                    d.setDate(d.getDate() - i);
                    return d.toISOString().split('T')[0];
                }).reverse();

                const signupCounts = dates.map(date =>
                    this.data.signups.filter(s =>
                        (s.timestamp || s.created).startsWith(date)
                    ).length
                );

                if (window.signupsChart) {
                    window.signupsChart.destroy();
                }

                const ctx = document.getElementById('signupsChart').getContext('2d');
                window.signupsChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: dates.map(d => d.split('-')[2]),
                        datasets: [{
                            label: 'Daily Signups',
                            data: signupCounts,
                            borderColor: 'rgba(16, 185, 129, 1)',
                            backgroundColor: 'rgba(16, 185, 129, 0.1)',
                            borderWidth: 2,
                            tension: 0.4,
                            fill: true
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                labels: {
                                    color: 'rgba(240, 240, 240, 0.8)'
                                }
                            }
                        },
                        scales: {
                            x: {
                                grid: {
                                    color: 'rgba(255, 255, 255, 0.05)'
                                },
                                ticks: {
                                    color: 'rgba(240, 240, 240, 0.6)'
                                }
                            },
                            y: {
                                grid: {
                                    color: 'rgba(255, 255, 255, 0.05)'
                                },
                                ticks: {
                                    color: 'rgba(240, 240, 240, 0.6)'
                                }
                            }
                        }
                    }
                });
            }

            updateLanguagesChart() {
                const languages = this.getLanguagePopularity();
                const labels = languages.map(l => l[0]);
                const data = languages.map(l => l[1]);

                if (window.languagesChart) {
                    window.languagesChart.destroy();
                }

                const ctx = document.getElementById('languagesChart').getContext('2d');
                window.languagesChart = new Chart(ctx, {
                    type: 'polarArea',
                    data: {
                        labels: labels.length > 0 ? labels : ['No data yet'],
                        datasets: [{
                            data: data.length > 0 ? data : [1],
                            backgroundColor: [
                                'rgba(212, 175, 55, 0.7)',
                                'rgba(16, 185, 129, 0.7)',
                                'rgba(59, 130, 246, 0.7)',
                                'rgba(139, 92, 246, 0.7)',
                                'rgba(236, 72, 153, 0.7)'
                            ]
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: {
                                    color: 'rgba(240, 240, 240, 0.8)'
                                }
                            }
                        }
                    }
                });
            }

            // Table Updates
            updateUsersTable() {
                const tbody = document.getElementById('users-table-body');
                tbody.innerHTML = this.data.users.map(user => `
                    <tr>
                        <td>${user.id}</td>
                        <td>${user.name}</td>
                        <td>${user.email}</td>
                        <td>${user.type}</td>
                        <td>${new Date(user.created).toLocaleDateString()}</td>
                        <td>
                            <button class="action-btn" title="Edit">‚úèÔ∏è</button>
                            <button class="action-btn" title="Delete">üóëÔ∏è</button>
                        </td>
                    </tr>
                `).join('') || '<tr><td colspan="6" style="text-align: center; color: var(--text-muted);">No users yet</td></tr>';
            }

            updateSignupsTable() {
                const tbody = document.getElementById('signups-table-body');
                tbody.innerHTML = this.data.signups.slice(-10).reverse().map(signup => `
                    <tr>
                        <td>${new Date(signup.timestamp || signup.created).toLocaleDateString()}</td>
                        <td>${signup.name || 'Anonymous'}</td>
                        <td>${signup.email || 'N/A'}</td>
                        <td>${signup.interests || 'General'}</td>
                        <td><span class="status-badge status-${signup.status}">${signup.status}</span></td>
                    </tr>
                `).join('') || '<tr><td colspan="5" style="text-align: center; color: var(--text-muted);">No signups yet</td></tr>';
            }

            updateCoursesTable() {
                const courses = this.getCoursePopularity();
                const tbody = document.getElementById('courses-table-body');

                if (courses.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="5" style="text-align: center; color: var(--text-muted);">No course views yet</td></tr>';
                    return;
                }

                tbody.innerHTML = courses.map(([course, views]) => {
                    const clicks = this.data.clicks.filter(c =>
                        c.text && c.text.toLowerCase().includes(course.toLowerCase())
                    ).length;
                    const conversion = clicks > 0 ? Math.round((views / clicks) * 100) : 0;

                    return `
                        <tr>
                            <td>${course}</td>
                            <td>${views}</td>
                            <td>${clicks}</td>
                            <td>${conversion}%</td>
                            <td>${views >= 100 ? 'üî• Hot' : views >= 50 ? 'üìà Trending' : 'üìö Normal'}</td>
                        </tr>
                    `;
                }).join('');
            }

            updatePaymentsTable() {
                const tbody = document.getElementById('payments-table-body');
                tbody.innerHTML = this.data.payments.slice(-10).reverse().map(payment => `
                    <tr>
                        <td>${new Date(payment.timestamp).toLocaleDateString()}</td>
                        <td>$${payment.amount}</td>
                        <td>${payment.donor || 'Anonymous'}</td>
                        <td>${payment.method || 'Card'}</td>
                        <td><span class="status-badge status-completed">${payment.status}</span></td>
                    </tr>
                `).join('') || '<tr><td colspan="5" style="text-align: center; color: var(--text-muted);">No payments yet</td></tr>';
            }

            updateLessonsTable() {
                const tbody = document.getElementById('lessons-table-body');
                tbody.innerHTML = this.data.lessons.slice(-20).reverse().map(lesson => {
                    const phone = (lesson.studentCountryCode || '') + ' ' + (lesson.studentPhone || '');
                    const subject = lesson.subject === 'custom' ? `Custom: ${lesson.customSubject}` : lesson.subject;

                    return `
                        <tr>
                            <td>${new Date(lesson.timestamp).toLocaleDateString()}</td>
                            <td>${lesson.studentName || 'New Student'}<br><small>${lesson.studentEmail}</small></td>
                            <td>${phone}</td>
                            <td>${subject || 'General Math'}</td>
                            <td>${lesson.duration || '60'} min</td>
                            <td><span class="status-badge status-${lesson.status}">${lesson.status}</span></td>
                            <td>
                                <button class="action-btn" title="Accept" onclick="updateLessonStatus('${lesson.id}', 'accepted')">‚úì</button>
                                <button class="action-btn" title="Decline" onclick="updateLessonStatus('${lesson.id}', 'declined')">‚úó</button>
                            </td>
                        </tr>
                    `;
                }).join('') || '<tr><td colspan="7" style="text-align: center; color: var(--text-muted);">No lesson requests yet</td></tr>';
            }

            updateStorageInfo() {
                let totalSize = 0;
                for (let key in localStorage) {
                    if (localStorage.hasOwnProperty(key)) {
                        totalSize += localStorage.getItem(key).length * 2; // Approximate size in bytes
                    }
                }

                const usageMB = (totalSize / (1024 * 1024)).toFixed(2);
                const percentage = Math.min((totalSize / (5 * 1024 * 1024)) * 100, 100); // 5MB limit

                document.getElementById('storage-usage').textContent = `${usageMB} MB / 5 MB`;
                document.getElementById('storage-bar').style.width = `${percentage}%`;
            }

            startAutoRefresh() {
                setInterval(() => {
                    this.loadData();
                }, 30000); // Refresh every 30 seconds
            }

            exportData() {
                const exportObj = {};
                Object.keys(this.data).forEach(key => {
                    exportObj[key] = this.data[key];
                });

                const dataStr = JSON.stringify(exportObj, null, 2);
                const dataUri = 'data:application/json;charset=utf-8,' + encodeURIComponent(dataStr);

                const exportFileDefaultName = `tensor-academy-data-${new Date().toISOString().split('T')[0]}.json`;

                const linkElement = document.createElement('a');
                linkElement.setAttribute('href', dataUri);
                linkElement.setAttribute('download', exportFileDefaultName);
                linkElement.click();
            }

            exportCSV() {
                // Simplified CSV export for users
                let csv = 'Name,Email,Type,Created\n';
                this.data.users.forEach(user => {
                    csv += `"${user.name}","${user.email}","${user.type}","${user.created}"\n`;
                });

                const blob = new Blob([csv], { type: 'text/csv' });
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `tensor-users-${new Date().toISOString().split('T')[0]}.csv`;
                a.click();
            }

            backupData() {
                const backup = {};
                for (let i = 0; i < localStorage.length; i++) {
                    const key = localStorage.key(i);
                    if (key.startsWith('tensor_')) {
                        backup[key] = localStorage.getItem(key);
                    }
                }

                localStorage.setItem('tensor_backup_' + Date.now(), JSON.stringify(backup));
                alert('Backup created successfully!');
            }

            clearAllData() {
                if (confirm('Are you sure you want to clear all data? This cannot be undone!')) {
                    const keys = [];
                    for (let i = 0; i < localStorage.length; i++) {
                        const key = localStorage.key(i);
                        if (key.startsWith('tensor_')) {
                            keys.push(key);
                        }
                    }

                    keys.forEach(key => localStorage.removeItem(key));
                    this.initializeData();
                    this.loadData();
                    alert('All data has been cleared!');
                }
            }
        }

        // Initialize Data Manager
        const dataManager = new DataManager();

        // UI Functions
        function showSection(sectionId) {
            // Hide all sections
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });

            // Remove active class from all nav links
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
            });

            // Show selected section
            document.getElementById(`${sectionId}-section`).classList.add('active');

            // Add active class to clicked nav link
            event.target.closest('.nav-link').classList.add('active');
        }

        function refreshData() {
            dataManager.loadData();
            alert('Data refreshed!');
        }

        function addUser() {
            document.getElementById('add-user-modal').classList.add('active');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        function saveUser(event) {
            event.preventDefault();

            const user = {
                name: document.getElementById('user-name').value,
                email: document.getElementById('user-email').value,
                type: document.getElementById('user-type').value,
                notes: document.getElementById('user-notes').value
            };

            dataManager.addUser(user);
            closeModal('add-user-modal');

            // Reset form
            event.target.reset();
        }

        function toggleDataCollection() {
            const checkbox = document.getElementById('data-collection');
            const status = document.getElementById('data-status');

            if (checkbox.checked) {
                status.textContent = 'Active - Collecting data from main site';
                localStorage.setItem('tensor_data_collection', 'enabled');
            } else {
                status.textContent = 'Disabled - Not collecting data';
                localStorage.setItem('tensor_data_collection', 'disabled');
            }
        }

        function exportData() {
            dataManager.exportData();
        }

        function exportCSV() {
            dataManager.exportCSV();
        }

        function backupData() {
            dataManager.backupData();
        }

        function clearAllData() {
            dataManager.clearAllData();
        }

        async function updateLessonStatus(id, status) {
            try {
                const response = await fetch('/api/admin/lessons/status', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ id, status })
                });

                if (response.ok) {
                    // Reload data to show updated status
                    await dataManager.loadData();
                } else {
                    alert('Failed to update status');
                }
            } catch (e) {
                console.error('Error updating status:', e);
            }
        }

        // Add some sample data for demonstration
        function addSampleData() {
            if (dataManager.data.users.length === 0) {
                // Add sample users
                const sampleUsers = [
                    { name: 'Mavasi Bashar', email: 'mavasi@tensor.edu', type: 'admin', notes: 'Founder' },
                    { name: 'Ahmed Hassan', email: 'ahmed@email.com', type: 'student', notes: 'Interested in Calculus' },
                    { name: 'Dr. Elena Petrov', email: 'elena@tensor.edu', type: 'teacher', notes: 'Mathematics Professor' }
                ];

                sampleUsers.forEach(user => dataManager.addUser(user));

                // Add sample signups
                const sampleSignups = [
                    { name: 'John Smith', email: 'john@email.com', interests: 'Linear Algebra' },
                    { name: 'Maria Rodriguez', email: 'maria@email.com', interests: 'Data Science' }
                ];

                sampleSignups.forEach(signup => dataManager.addSignup(signup));

                // Add sample course views
                dataManager.trackCourseView('Calculus & Analysis');
                dataManager.trackCourseView('Linear Algebra');
                dataManager.trackCourseView('Linear Algebra');
                dataManager.trackCourseView('Abstract Algebra');

                // Add sample language clicks
                dataManager.trackLanguageClick('English');
                dataManager.trackLanguageClick('Arabic');
                dataManager.trackLanguageClick('Hebrew');
                dataManager.trackLanguageClick('English');

                alert('Sample data added for demonstration!');
                dataManager.loadData();
            }
        }

        // Auto-add sample data if no data exists
        setTimeout(addSampleData, 1000);
    </script>
</body>

</html>